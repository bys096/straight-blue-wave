{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ban-yeongseo/Projects/straight-blue-wave/react-server/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/ban-yeongseo/Projects/straight-blue-wave/react-server/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ban-yeongseo/Projects/straight-blue-wave/react-server/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Container}from\"react-bootstrap\";import React,{useRef,useState}from'react';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MainPage(props){var socket=io();var myFaceRef=useRef(null);var muteRef=useRef(null);var cameraRef=useRef(null);var camerasRef=useRef(null);var callRef=useRef(null);var welcomeRef=useRef(null);var welcomeFormRef=useRef(null);var peerFaceRef=useRef(null);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),hidden=_useState2[0],setHidden=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),welHidden=_useState4[0],setWelHidden=_useState4[1];// 추가\nvar streamBoxRef=useRef(null);var streamsRef=useRef(null);var myStreamRef=useRef(null);var userNickNameRef=useRef(null);var controllersRef=useRef(null);var buttonsRef=useRef(null);var chatRoomRef=useRef(null);var chatBoxRef=useRef(null);var chatFormRef=useRef(null);var roomNameRef=useRef(null);var nickNameRef=useRef(null);var HIDDEN=\"hidden\";var myPeerConnection=null;var myStream;var muted=false;var cameraOff=false;var roomName=\"\";var nickName=\"\";var myDataChannel;var peopleInRoom=1;var pcObj={};function getCameras(){return _getCameras.apply(this,arguments);}function _getCameras(){_getCameras=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var devices,cameras,currentCamera;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return navigator.mediaDevices.enumerateDevices();case 3:devices=_context5.sent;cameras=devices.filter(function(device){return device.kind===\"videoinput\";});currentCamera=myStream.getVideoTracks()[0];cameras.forEach(function(camera){var option=document.createElement(\"option\");option.value=camera.deviceId;option.innerText=camera.label;if(currentCamera.label===camera.label){option.selected=true;}camerasRef.current.appendChild(option);});_context5.next=12;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 12:case\"end\":return _context5.stop();}},_callee5,null,[[0,9]]);}));return _getCameras.apply(this,arguments);}function getMedia(_x){return _getMedia.apply(this,arguments);}function _getMedia(){_getMedia=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(deviceId){var initialConstrains,cameraConstraints;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:initialConstrains={audio:true,video:{facingMode:\"user\"}};cameraConstraints={audio:true,video:{deviceId:{exact:deviceId}}};_context6.prev=2;_context6.next=5;return navigator.mediaDevices.getUserMedia(// deviceId가 있다면 특정 camera로, 없다면 셀프 카메라로 설정\ndeviceId?cameraConstraints:initialConstrains);case 5:myStream=_context6.sent;myFaceRef.current.srcObject=myStream;myFaceRef.current.muted=true;if(deviceId){_context6.next=12;break;}myStream.getAudioTracks().forEach(function(track){return track.enabled=false;});_context6.next=12;return getCameras();case 12:_context6.next=17;break;case 14:_context6.prev=14;_context6.t0=_context6[\"catch\"](2);console.log(_context6.t0);case 17:case\"end\":return _context6.stop();}},_callee6,null,[[2,14]]);}));return _getMedia.apply(this,arguments);}function handleMuteClick(){myStream.getAudioTracks().forEach(function(track){return track.enabled=!track.enabled;});if(!muted){muteRef.class.innerText=\"Unmute\";muted=true;}else{muteRef.class.innerText=\"Mute\";muted=false;}}function handleCameraClick(){myStream.getVideoTracks().forEach(function(track){return track.enabled=!track.enabled;});if(cameraOff){cameraRef.current.innerText=\"Turn Camera Off\";cameraOff=false;}else{cameraRef.current.innerText=\"Turn Camera On\";cameraOff=true;}}function handleCameraChange(){return _handleCameraChange.apply(this,arguments);}function _handleCameraChange(){_handleCameraChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){var videoTrack,videoSender;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:_context7.next=2;return getMedia(camerasRef.current.value);case 2:if(myPeerConnection){videoTrack=myStream.getVideoTracks()[0];videoSender=myPeerConnection.getSenders().find(function(sender){return sender.track.kind===\"video\";});videoSender.replaceTrack(videoTrack);}case 3:case\"end\":return _context7.stop();}},_callee7);}));return _handleCameraChange.apply(this,arguments);}function initCall(){return _initCall.apply(this,arguments);}// 추가\n// let captureStream = null;\n// async function startCapture() {\n//   try {\n//     captureStream = await navigator.mediaDevices.getDisplayMedia({\n//       video: true,\n//       audio: true,\n//     });\n//     const screen\n//   }\n// }\nfunction _initCall(){_initCall=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:setWelHidden(true);setHidden(false);_context8.next=4;return getMedia();case 4:case\"end\":return _context8.stop();}},_callee8);}));return _initCall.apply(this,arguments);}function handleWelcomeSubmit(_x2){return _handleWelcomeSubmit.apply(this,arguments);}// Socket code\nfunction _handleWelcomeSubmit(){_handleWelcomeSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(event){var welcomeRoomName,welcomeNickName,nickNameContainer;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:event.preventDefault();welcomeRoomName=roomNameRef.current;welcomeNickName=nickNameRef.current;nickNameContainer=userNickNameRef.current;console.log(\"click handle\");if(socket.disconnected){socket.connect();}// await initCall();\nroomName=welcomeRoomName.value;welcomeRoomName.value=\"\";nickName=welcomeNickName.value;welcomeNickName.value=\"\";nickNameContainer.innerText=nickName;socket.emit(\"join_room\",roomName,nickName);case 12:case\"end\":return _context9.stop();}},_callee9);}));return _handleWelcomeSubmit.apply(this,arguments);}socket.on(\"reject_join\",function(){// paintModal\nvar nickNameContainer=userNickNameRef.current;nickNameContainer.innerText=\"\";roomName=\"\";nickName=\"\";});socket.on(\"accept_join\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(userObjArr){var length,i,newPC,offer;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return initCall();case 2:length=userObjArr.length;if(!(length===1)){_context.next=5;break;}return _context.abrupt(\"return\");case 5:i=0;case 6:if(!(i<length-1)){_context.next=23;break;}_context.prev=7;newPC=createConnection(userObjArr[i].socketId,userObjArr[i].nickName);_context.next=11;return newPC.createOffer();case 11:offer=_context.sent;_context.next=14;return newPC.setLocalDescription(offer);case 14:socket.emit(\"offer\",offer,userObjArr[i].socketId,nickName);// wirteChat\n_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](7);console.error(_context.t0);case 20:i++;_context.next=6;break;case 23:case\"end\":return _context.stop();}},_callee,null,[[7,17]]);}));return function(_x3){return _ref.apply(this,arguments);};}());socket.on(\"offer\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(offer,remoteSocketId,remoteNickName){var newPC,answer;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;console.log(\"received offer\");newPC=createConnection(remoteSocketId,remoteNickName);_context2.next=5;return newPC.setRemoteDescription(offer);case 5:_context2.next=7;return newPC.createAnswer();case 7:answer=_context2.sent;_context2.next=10;return newPC.setLocalDescription(answer);case 10:socket.emit(\"answer\",answer,remoteSocketId);// writeChat\n_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0);case 16:case\"end\":return _context2.stop();}},_callee2,null,[[0,13]]);}));return function(_x4,_x5,_x6){return _ref2.apply(this,arguments);};}());socket.on(\"answer\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(answer,remoteSocketId){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:console.log(\"received the answer\");_context3.next=3;return pcObj[remoteSocketId].setRemoteDescription(answer);case 3:case\"end\":return _context3.stop();}},_callee3);}));return function(_x7,_x8){return _ref3.apply(this,arguments);};}());socket.on(\"ice\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(ice,remoteSocketId){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return pcObj[remoteSocketId].addIceCandidate(ice);case 2:case\"end\":return _context4.stop();}},_callee4);}));return function(_x9,_x10){return _ref4.apply(this,arguments);};}());// socket.on(chat)\n// socket.on(\"leave\")\n// RTC Code\nfunction createConnection(remoteSocketId,remoteNickName){myPeerConnection=new RTCPeerConnection({iceServers:[{urls:[\"stun:stun.l.google.com:19302\",\"stun:stun1.l.google.com:19302\",\"stun:stun2.l.google.com:19302\",\"stun:stun3.l.google.com:19302\",\"stun:stun4.l.google.com:19302\"]}]});myPeerConnection.addEventListener(\"icecandidate\",function(event){handleIce(event,remoteSocketId);});myPeerConnection.addEventListener(\"icecandidate\",function(event){handleTrack(event,remoteSocketId,remoteNickName);});// myPeerConnection.addEventListener(\"track\", handleTrack); // 이 부분이 추가됩니다.\nmyStream.getTracks().forEach(function(track){return myPeerConnection.addTrack(track,myStream);});pcObj[remoteSocketId]=myPeerConnection;++peopleInRoom;sortStreams();return myPeerConnection;}function handleIce(event,remoteSocketId){if(event.candidate){socket.emit(\"ice\",event.candidate,remoteSocketId);}}// function handleAddStream(data) {\n//   if (peerFaceRef.current) {\n//     peerFaceRef.current.srcObject = data.stream;\n//   } else {\n//     console.log('peerFaceRef.current is not defined');\n//   }\n// }\nfunction handleTrack(event,remoteSocketId,remoteNickName){var peerStream=event.stream;paintPeerFace(peerStream,remoteSocketId,remoteNickName);}function paintPeerFace(peerStream,id,remoteNickName){var div=document.createElement(\"div\");div.id=id;var video=document.createElement(\"video\");video.autoplay=true;video.playsInline=true;video.width=\"400\";video.height=\"400\";video.srcObject=peerStream;var nickNameContainer=document.createElement(\"h3\");nickNameContainer.id=\"userNickName\";nickNameContainer.innerText=remoteNickName;div.appendChild(video);div.appendChild(nickNameContainer);streamsRef.current.appendChild(div);sortStreams();}function sortStreams(){var streamArr=streamsRef.current.querySelectorAll(\"div\");streamArr.forEach(function(stream){return stream.className=\"people\".concat(peopleInRoom);});}return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uC601\\uC0C1\\uD1B5\\uD654\"}),/*#__PURE__*/_jsx(\"div\",{className:\"video\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{id:\"welcome\",ref:welcomeRef,style:{display:welHidden?\"none\":\"block\"},children:/*#__PURE__*/_jsxs(\"form\",{ref:welcomeFormRef,children:[/*#__PURE__*/_jsx(\"input\",{ref:roomNameRef,placeholder:\"room name\",required:true,type:\"text\"}),/*#__PURE__*/_jsx(\"input\",{ref:nickNameRef,placeholder:\"nick name\",type:\"text\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleWelcomeSubmit,children:\"Enter room\"})]})}),/*#__PURE__*/_jsxs(\"div\",{id:\"call\",ref:callRef,style:{display:hidden?\"none\":\"block\"},children:[/*#__PURE__*/_jsxs(\"div\",{ref:streamBoxRef,children:[/*#__PURE__*/_jsx(\"div\",{ref:streamsRef,children:/*#__PURE__*/_jsxs(\"div\",{ref:myStream,className:\"people1\",children:[/*#__PURE__*/_jsx(\"video\",{id:\"myFace\",ref:myFaceRef,autoPlay:true,playsInline:true,width:\"400\",height:\"400\"}),/*#__PURE__*/_jsx(\"h3\",{ref:userNickNameRef})]})}),/*#__PURE__*/_jsxs(\"div\",{ref:controllersRef,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"select\",{id:\"cameras\",ref:camerasRef,onChange:handleCameraChange})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{ref:buttonsRef,children:[/*#__PURE__*/_jsx(\"button\",{id:\"mute\",ref:muteRef,onClick:handleMuteClick,children:\"Mute\"}),/*#__PURE__*/_jsx(\"button\",{id:\"camera\",ref:cameraRef,onClick:handleCameraClick,children:\"Turn Camera Off\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{children:\"Leave\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{ref:chatRoomRef,children:/*#__PURE__*/_jsx(\"ul\",{ref:chatBoxRef,children:/*#__PURE__*/_jsxs(\"form\",{ref:chatFormRef,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Write your chat\"}),/*#__PURE__*/_jsx(\"button\",{children:\"Send\"})]})})})]})]})})]});}export default MainPage;","map":{"version":3,"names":["Container","React","useRef","useState","io","jsx","_jsx","jsxs","_jsxs","MainPage","props","socket","myFaceRef","muteRef","cameraRef","camerasRef","callRef","welcomeRef","welcomeFormRef","peerFaceRef","_useState","_useState2","_slicedToArray","hidden","setHidden","_useState3","_useState4","welHidden","setWelHidden","streamBoxRef","streamsRef","myStreamRef","userNickNameRef","controllersRef","buttonsRef","chatRoomRef","chatBoxRef","chatFormRef","roomNameRef","nickNameRef","HIDDEN","myPeerConnection","myStream","muted","cameraOff","roomName","nickName","myDataChannel","peopleInRoom","pcObj","getCameras","_getCameras","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee5","devices","cameras","currentCamera","wrap","_callee5$","_context5","prev","next","navigator","mediaDevices","enumerateDevices","sent","filter","device","kind","getVideoTracks","forEach","camera","option","document","createElement","value","deviceId","innerText","label","selected","current","appendChild","t0","console","log","stop","getMedia","_x","_getMedia","_callee6","initialConstrains","cameraConstraints","_callee6$","_context6","audio","video","facingMode","exact","getUserMedia","srcObject","getAudioTracks","track","enabled","handleMuteClick","class","handleCameraClick","handleCameraChange","_handleCameraChange","_callee7","videoTrack","videoSender","_callee7$","_context7","getSenders","find","sender","replaceTrack","initCall","_initCall","_callee8","_callee8$","_context8","handleWelcomeSubmit","_x2","_handleWelcomeSubmit","_callee9","event","welcomeRoomName","welcomeNickName","nickNameContainer","_callee9$","_context9","preventDefault","disconnected","connect","emit","on","_ref","_callee","userObjArr","length","i","newPC","offer","_callee$","_context","abrupt","createConnection","socketId","createOffer","setLocalDescription","error","_x3","_ref2","_callee2","remoteSocketId","remoteNickName","answer","_callee2$","_context2","setRemoteDescription","createAnswer","_x4","_x5","_x6","_ref3","_callee3","_callee3$","_context3","_x7","_x8","_ref4","_callee4","ice","_callee4$","_context4","addIceCandidate","_x9","_x10","RTCPeerConnection","iceServers","urls","addEventListener","handleIce","handleTrack","getTracks","addTrack","sortStreams","candidate","peerStream","stream","paintPeerFace","id","div","autoplay","playsInline","width","height","streamArr","querySelectorAll","className","concat","children","ref","style","display","placeholder","required","type","onClick","autoPlay","onChange"],"sources":["/Users/ban-yeongseo/Projects/straight-blue-wave/react-server/src/pages/MainPage.js"],"sourcesContent":["import {Container} from \"react-bootstrap\";\nimport React, {useRef, useState} from 'react';\nimport io from 'socket.io-client';\n\n\nfunction MainPage(props) {\n\n\tconst socket = io();\n  const myFaceRef = useRef(null);\n  const muteRef = useRef(null);\n  const cameraRef = useRef(null);\n  const camerasRef = useRef(null);\n  const callRef = useRef(null);\n  const welcomeRef = useRef(null);\n  const welcomeFormRef = useRef(null);\n  const peerFaceRef = useRef(null);\n  const [hidden, setHidden] = useState(true);\n  const [welHidden, setWelHidden] = useState(false);\n\n  // 추가\n  const streamBoxRef = useRef(null);\n  const streamsRef = useRef(null);\n  const myStreamRef = useRef(null);\n  const userNickNameRef = useRef(null);\n  const controllersRef = useRef(null);\n  const buttonsRef = useRef(null);\n  const chatRoomRef = useRef(null);\n  const chatBoxRef = useRef(null);\n  const chatFormRef = useRef(null);\n  const roomNameRef = useRef(null);\n  const nickNameRef = useRef(null);\n\n  const HIDDEN = \"hidden\";\n\n\n\n  let myPeerConnection = null;\n  let myStream;\n  let muted = false;\n  let cameraOff = false;\n  let roomName = \"\";\n  let nickName = \"\";\n  \n  let myDataChannel;\n  let peopleInRoom = 1;\n  let pcObj = {};\n  \nasync function getCameras() {\ntry {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  const cameras = devices.filter((device) => device.kind === \"videoinput\");\n  const currentCamera = myStream.getVideoTracks()[0];\n  cameras.forEach((camera) => {\n    const option = document.createElement(\"option\");\n    option.value = camera.deviceId;\n    option.innerText = camera.label;\n    if (currentCamera.label === camera.label) {\n      option.selected = true;\n    }\n    camerasRef.current.appendChild(option);\n  });\n} catch (e) {\n  console.log(e);\n}\n}\n\nasync function getMedia(deviceId) {\nconst initialConstrains = {\n  audio: true,\n  video: { facingMode: \"user\" },\n};\nconst cameraConstraints = {\n  audio: true,\n  video: { deviceId: { exact: deviceId } },\n};\ntry {\n  myStream = await navigator.mediaDevices.getUserMedia(\n    // deviceId가 있다면 특정 camera로, 없다면 셀프 카메라로 설정\n    deviceId ? cameraConstraints : initialConstrains\n  );\n  myFaceRef.current.srcObject = myStream;\n  myFaceRef.current.muted = true;\n  if (!deviceId) {\n    myStream\n      .getAudioTracks()\n      .forEach((track) => (track.enabled = false));\n    await getCameras();\n  }\n} catch (e) {\n  console.log(e);\n}\n}\n\nfunction handleMuteClick() {\nmyStream\n  .getAudioTracks()\n  .forEach((track) => (track.enabled = !track.enabled));\nif (!muted) {\n  muteRef.class.innerText = \"Unmute\";\n  muted = true;\n} else {\n  muteRef.class.innerText = \"Mute\";\n  muted = false;\n}\n}\nfunction handleCameraClick() {\nmyStream\n  .getVideoTracks()\n  .forEach((track) => (track.enabled = !track.enabled));\nif (cameraOff) {\n  cameraRef.current.innerText = \"Turn Camera Off\";\n  cameraOff = false;\n} else {\n  cameraRef.current.innerText = \"Turn Camera On\";\n  cameraOff = true;\n}\n}\n\nasync function handleCameraChange() {\n// select 한 camera id를 기준으로 다시 getMedia를 통해 미디어 스트림을 가져옴\nawait getMedia(camerasRef.current.value);\nif (myPeerConnection) {\n  const videoTrack = myStream.getVideoTracks()[0];\n  const videoSender = myPeerConnection\n    .getSenders()\n    .find((sender) => sender.track.kind === \"video\");\n  videoSender.replaceTrack(videoTrack);\n}\n}\n\n\n\n\nasync function initCall() {\nsetWelHidden(true);\nsetHidden(false);\nawait getMedia();\n// makeConnection();\n}\n\n\n\n\n\n// 추가\n\n\n// let captureStream = null;\n// async function startCapture() {\n//   try {\n//     captureStream = await navigator.mediaDevices.getDisplayMedia({\n//       video: true,\n//       audio: true,\n//     });\n\n//     const screen\n//   }\n// }\n\n\n\n\n\n\n\n\nasync function handleWelcomeSubmit(event) {\nevent.preventDefault();\nconst welcomeRoomName = roomNameRef.current;\nconst welcomeNickName = nickNameRef.current;\nconst nickNameContainer = userNickNameRef.current;\nconsole.log(\"click handle\");\nif(socket.disconnected) {\n  socket.connect();\n}\n// await initCall();\nroomName = welcomeRoomName.value;\nwelcomeRoomName.value = \"\";\nnickName = welcomeNickName.value;\nwelcomeNickName.value = \"\";\nnickNameContainer.innerText = nickName;\nsocket.emit(\"join_room\", roomName, nickName);\n}\n\n\n\n\n\n\n// Socket code\n\nsocket.on(\"reject_join\", () => {\n  // paintModal\n\n  const nickNameContainer = userNickNameRef.current;\n  nickNameContainer.innerText = \"\";\n  roomName = \"\";\n  nickName = \"\";\n});\n\nsocket.on(\"accept_join\", async(userObjArr) => {\n  await initCall();\n  const length = userObjArr.length;\n  if(length === 1) {\n    return;\n  }\n\n  // writeChat\n  for(let i = 0; i < length - 1; i++) {\n    try {\n      const newPC = createConnection(\n        userObjArr[i].socketId,\n        userObjArr[i].nickName\n      );\n      const offer = await newPC.createOffer();\n      await newPC.setLocalDescription(offer);\n      socket.emit(\"offer\", offer, userObjArr[i].socketId, nickName);\n      // wirteChat\n    } catch(err) {\n      console.error(err);\n    }\n  }\n  // writeChat\n});\n\n\nsocket.on(\"offer\", async (offer, remoteSocketId, remoteNickName) => {\n  try {\n    console.log(\"received offer\");\n    const newPC = createConnection(remoteSocketId, remoteNickName);\n    await newPC.setRemoteDescription(offer);\n    const answer = await newPC.createAnswer();\n    await newPC.setLocalDescription(answer);\n    socket.emit(\"answer\", answer, remoteSocketId);\n    // writeChat\n  } catch(err) {\n    console.error(err);\n  }\n});\n\nsocket.on(\"answer\", async (answer, remoteSocketId) => {\n  console.log(\"received the answer\");\n  await pcObj[remoteSocketId].setRemoteDescription(answer);\n});\n\n\nsocket.on(\"ice\", async (ice, remoteSocketId) => {\n  await pcObj[remoteSocketId].addIceCandidate(ice);\n});\n\n// socket.on(chat)\n\n// socket.on(\"leave\")\n\n\n\n\n\n// RTC Code\n\nfunction createConnection(remoteSocketId, remoteNickName) {\n  myPeerConnection = new RTCPeerConnection({\n    iceServers: [\n      {\n        urls: [\n          \"stun:stun.l.google.com:19302\",\n          \"stun:stun1.l.google.com:19302\",\n          \"stun:stun2.l.google.com:19302\",\n          \"stun:stun3.l.google.com:19302\",\n          \"stun:stun4.l.google.com:19302\",\n        ],\n      },\n    ],\n  });\n  myPeerConnection.addEventListener(\"icecandidate\", (event) => {\n    handleIce(event, remoteSocketId);\n  });\n  myPeerConnection.addEventListener(\"icecandidate\", (event) => {\n    handleTrack(event, remoteSocketId, remoteNickName);\n  });\n  // myPeerConnection.addEventListener(\"track\", handleTrack); // 이 부분이 추가됩니다.\n  myStream.getTracks().forEach((track) => myPeerConnection.addTrack(track, myStream));\n  pcObj[remoteSocketId] = myPeerConnection;\n\n  ++peopleInRoom;\n  sortStreams();\n  return myPeerConnection;\n}\n\nfunction handleIce(event, remoteSocketId) {\n  if(event.candidate) {\n    socket.emit(\"ice\", event.candidate, remoteSocketId);\n  }\n}\n// function handleAddStream(data) {\n//   if (peerFaceRef.current) {\n//     peerFaceRef.current.srcObject = data.stream;\n//   } else {\n//     console.log('peerFaceRef.current is not defined');\n//   }\n// }\nfunction handleTrack(event, remoteSocketId, remoteNickName) {\n  const peerStream = event.stream;\n  paintPeerFace(peerStream, remoteSocketId, remoteNickName);\n}\n\nfunction paintPeerFace(peerStream, id, remoteNickName) {\n  const div = document.createElement(\"div\");\n  div.id = id;\n  const video = document.createElement(\"video\");\n  video.autoplay = true;\n  video.playsInline = true;\n  video.width = \"400\";\n  video.height = \"400\";\n  video.srcObject = peerStream;\n  const nickNameContainer = document.createElement(\"h3\");\n  nickNameContainer.id = \"userNickName\";\n  nickNameContainer.innerText = remoteNickName;\n\n  div.appendChild(video);\n  div.appendChild(nickNameContainer);\n  streamsRef.current.appendChild(div);\n  sortStreams();\n}\n\nfunction sortStreams() {\n  const streamArr = streamsRef.current.querySelectorAll(\"div\");\n  streamArr.forEach((stream) => (stream.className = `people${peopleInRoom}`));\n}\n\n\treturn (\n\t\t<Container>\n\t\t\t<h1>영상통화</h1>\n\t\t\t<div className=\"video\">\n        <div>\n            <div id=\"welcome\" ref={welcomeRef} \n                style={{display: welHidden ? \"none\" : \"block\"}}\n            >\n              <form ref={welcomeFormRef}>\n                <input ref={roomNameRef} placeholder=\"room name\" required type=\"text\"/>\n                <input ref={nickNameRef} placeholder=\"nick name\" type=\"text\"/>\n                <button onClick={handleWelcomeSubmit}>Enter room</button>\n              </form>\n            </div>\n            <div id=\"call\" ref={callRef}\n                style={{ display: hidden ? \"none\" : \"block\" }}\n            >\n\n              <div ref={streamBoxRef}>\n                <div ref={streamsRef}>\n                  <div ref={myStream} className=\"people1\">\n                    <video id=\"myFace\"ref={myFaceRef} autoPlay playsInline width=\"400\" height=\"400\"></video>\n                    <h3 ref={userNickNameRef}></h3>\n                  </div>\n                </div>\n                <div ref={controllersRef}>\n                  <div>\n                    <select id=\"cameras\" ref={camerasRef} onChange={handleCameraChange}></select>\n                  </div>\n                  <div>\n                    <div ref={buttonsRef}>\n                      <button id=\"mute\" ref={muteRef} onClick={handleMuteClick}>Mute</button>\n                      <button id=\"camera\" ref={cameraRef} onClick={handleCameraClick}>Turn Camera Off</button>\n                    </div>\n                  </div>\n                  <div>\n                    <button>Leave</button>\n                  </div>\n                </div>\n              </div>\n\n              <div ref={chatRoomRef}>\n                <ul ref={chatBoxRef}>\n                  <form ref={chatFormRef}>\n                    <input type=\"text\" placeholder=\"Write your chat\"/>\n                    <button>Send</button>\n                  </form>\n                </ul>\n              </div>\n            </div>\n        </div>\n\t\t\t</div>\n\t\t</Container>\n\t);\n}\n\nexport default MainPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}